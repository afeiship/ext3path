!function(t,e){t.declare("nx.net.AjaxConfig",{statics:{defaults:{method:"GET",dataType:"json",async:!1,timeout:-1,data:null,headers:{},error:t.noop,success:t.noop,complete:t.noop},READY_STATE:{DONE:4,HEADERS_RECEIVED:2,LOADING:3,OPENED:1,UNSENT:0},ERROR_CODE:{TIMEOUT:1e3,REQUEST:1001},CONTENT_TYPE:{get:"text/plain;charset=UTF-8",post:"application/x-www-form-urlencoded;charset=UTF-8"}}})}(nx,nx.GLOBAL),function(t,e){t.declare("nx.net.AjaxResponse",{properties:{responseText:{get:function(){return"text"===this._dataType?this.xhr.responseText:void 0}},responseJSON:{get:function(){if("json"===this._dataType){var t=this.xhr.responseText;return JSON.parse(t)}}},responseXML:{get:function(){return"xml"===this._dataType?this.xhr.responseXML:void 0}}},methods:{init:function(t,e){this.xhr=t,this.options=e,this._dataType=this.options.dataType}}})}(nx,nx.GLOBAL),function(t,e){t.declare("nx.net.XMLHttpRequest",{statics:{init:function(){this.normalize()},exist:function(){return!!e.XMLHttpRequest},normalize:function(){this.exist()||(e.XMLHttpRequest=function(){return new e.ActiveXObject(navigator.userAgent.indexOf("MSIE 5")>=0?"Microsoft.XMLHTTP":"Msxml2.XMLHTTP")})},getInstance:function(){return new e.XMLHttpRequest}}})}(nx,nx.GLOBAL),function(t,e){var s=t.net.AjaxConfig,n=t.net.AjaxResponse,o=e.navigator,i=e.location,r=t.declare("nx.net.Ajax",{mixins:[t.net.AjaxProcessor],statics:{toQueryString:function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}},methods:{init:function(){this._abortTime=null,this._complete=!1,this.xhr=t.net.XMLHttpRequest.getInstance()},request:function(t,e){this.normalizeOptions(e),this.timeoutProcessor(),this.headersProcessor(),this.stateEventProcessor(),this.requestProcessor()},get:function(t,e){this.xhr.open("GET",t),this.onreadystatechange(e,this.xhr),this.xhr.send(null)},post:function(t,e,s){this.xhr.open("POST",t),this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.onreadystatechange(s),this.xhr.send(e)},normalizeOptions:function(e){var n={method:e.method.toUpperCase()};this.options=t.mix(s.defaults,e,n)},timeoutProcessor:function(){var t=this.options,e=t.timeout,n=this.xhr;e>0&&(this._abortTime=setTimeout(function(){n.onreadystatechange=$.noop,n.abort(),t.error({code:s.ERROR_CODE.TIMEOUT,msg:"timeout",data:null})},e))},headersProcessor:function(){var t=this.options.headers;this.setHeaders(t)},dataProcessor:function(){var t=this.options.data,e=r.toQueryString(t);this._data=e},stateEventProcessor:function(t){var e,o=this.xhr,i=this.options,r=this;o.onreadystatechange=function(){o.readyState===s.READY_STATE.DONE&&(e=new n(o,i),r.requestSuccess()?i.success(e):i.error({code:s.ERROR_CODE.REQUEST,msg:"request",data:{response:e}}),i.complete(e),r._complete=!0,r.xhr=null)}},requestProcessor:function(){var t=this.options.method;switch(t){case"GET":case"POST":this["do"+t].call(this);break;default:this.doREQUEST.call(this)}},doGET:function(){var t=this.options,e=t.url;t.data&&(e+=e.indexOf("?")>-1?"&":"?"+this._data),this.setHeader("Content-Type",this.options.contentType||s.CONTENT_TYPE.get),this.xhr.open("GET",e,t.async),this.xhr.send(null)},doPOST:function(){var t=this.options,e=t.url;this.setHeader("Content-Type",t.contentType||s.CONTENT_TYPE.post),this.xhr.open("POST",e,t.async),this.xhr.send(this._data)},doREQUEST:function(){var t=this.options;this.xhr.open(t.method,t.url,t.async),this.xhr.send()},requestSuccess:function(){var t=this.xhr;try{return!t.status&&"file:"==i.protocol||t.status>=200&&t.status<300||304==t.status||o.userAgent.indexOf("Safari")>-1&&"undefined"==typeof t.status}catch(e){}return!1},setHeader:function(t,e){xhr.setRequestHeader(t,e)},setHeaders:function(e){var s=this.xhr;t.each(e,function(t,e){s.setRequestHeader(e,t)})}}})}(nx,nx.GLOBAL);