!function(t,e){t.declare("nx.net.AjaxConfig",{statics:{defaults:{method:"GET",dataType:"json",async:!0,timeout:-1,data:null,headers:{},contentType:null,error:t.noop,success:t.noop,complete:t.noop},READY_STATE:{DONE:4,HEADERS_RECEIVED:2,LOADING:3,OPENED:1,UNSENT:0},ERROR_CODE:{TIMEOUT:1e3,REQUEST:1001},CONTENT_TYPE:{get:"text/plain;charset=UTF-8",post:"application/x-www-form-urlencoded;charset=UTF-8"}}})}(nx,nx.GLOBAL),function(t,e){t.declare("nx.net.AjaxResponse",{properties:{responseText:{get:function(){return"text"===this._dataType?this.xhr.responseText:void 0}},responseJSON:{get:function(){if("json"===this._dataType){var t=this.xhr.responseText;return JSON.parse(t)}}},responseXML:{get:function(){return"xml"===this._dataType?this.xhr.responseXML:void 0}}},methods:{init:function(t,e){this.xhr=t,this.options=e,this._dataType=this.options.dataType}}})}(nx,nx.GLOBAL),function(t,e){t.declare("nx.net.XMLHttpRequest",{statics:{init:function(){this.normalize()},exist:function(){return!!e.XMLHttpRequest},normalize:function(){this.exist()||(e.XMLHttpRequest=function(){return new e.ActiveXObject(navigator.userAgent.indexOf("MSIE 5")>=0?"Microsoft.XMLHTTP":"Msxml2.XMLHTTP")})},getInstance:function(){return new e.XMLHttpRequest}}})}(nx,nx.GLOBAL),function(t,e){var n=t.net.AjaxConfig,s=t.net.AjaxResponse,o=e.navigator,i=e.location,r=t.declare("nx.net.Ajax",{statics:{request:function(t,e){r.getInstance().request(t,e)},get:function(e,n){var s=t.mix(n,{method:"GET"});r.getInstance().request(e,s)},post:function(e,n){var s=t.mix(n,{method:"POST"});r.getInstance().request(e,s)},getInstance:function(){return this._instance||(this._instance=new r),this._instance},toQueryString:function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}},methods:{request:function(e,n){this.xhr=t.net.XMLHttpRequest.getInstance(),this.normalizeOptions(e,n),this.dataProcessor(),this.timeoutProcessor(),this.headersProcessor(),this.stateEventProcessor(),this.requestProcessor()},normalizeOptions:function(e,s){var o={url:e,method:s.method.toUpperCase()};this.options=t.mix(n.defaults,s,o)},timeoutProcessor:function(){var t,e=this.options,o=e.timeout,i=this.xhr;o>0&&(this._abortTime=setTimeout(function(){t=new s(i),i.onreadystatechange=$.noop,i.abort(),e.error({code:n.ERROR_CODE.TIMEOUT,msg:"timeout",data:{response:t}}),e.complete(t)},o))},headersProcessor:function(){var t=this.options.headers;this.setHeaders(t)},dataProcessor:function(){var t=this.options.data;this._data=r.toQueryString(t)},stateEventProcessor:function(t){var e,o=this.xhr,i=this.options,r=this;o.onreadystatechange=function(){o.readyState===n.READY_STATE.DONE&&(e=new s(o,i),r.requestSuccess()?i.success(e):i.error({code:n.ERROR_CODE.REQUEST,msg:"request",data:{response:e}}),i.complete(e),r._complete=!0,r.xhr=null,clearTimeout(r._abortTime),r._abortTime=null)}},requestProcessor:function(){var t=this.options.method;switch(t){case"GET":case"POST":this["do"+t].call(this);break;default:this.doREQUEST.call(this)}},doGET:function(){var t=this.options,e=t.url;t.data&&(e+=e.indexOf("?")>-1?"&":"?"+this._data),this.xhr.open("GET",e,t.async),this.setHeader("Content-Type",t.contentType||n.CONTENT_TYPE.get),this.xhr.send(null)},doPOST:function(){var t=this.options,e=t.url;this.xhr.open("POST",e,t.async),this.setHeader("Content-Type",t.contentType||n.CONTENT_TYPE.post),this.xhr.send(this._data)},doREQUEST:function(){var t=this.options;this.xhr.open(t.method,t.url,t.async),this.xhr.send()},requestSuccess:function(){var t=this.xhr;try{return!t.status&&"file:"==i.protocol||t.status>=200&&t.status<300||304==t.status||o.userAgent.indexOf("Safari")>-1&&"undefined"==typeof t.status}catch(e){}return!1},setHeader:function(t,e){this.xhr.setRequestHeader(t,e)},setHeaders:function(e){var n=this.xhr;t.each(e,function(t,e){n.setRequestHeader(e,t)})}}})}(nx,nx.GLOBAL);